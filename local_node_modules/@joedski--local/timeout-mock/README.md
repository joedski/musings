timeout-mock
============

A dead-simple mock for `setTimeout`/`clearTimeout`.

There's probably a better module out there, but this works fine.



## Example

```js
const assert = require('assert').strict;
const createTimeoutMocks = require('@joedski--local/timeout-mock');

// create a set of timeouts specifically for your current set of tests.
const timeouts = createTimeoutMocks();

// functions already close over their created context,
// so you can pull them off, pass them directly, etc.
const { setTimeout, clearTimeout } = timeouts;
let count = 0;

// Set a timeout.
setTimeout(() => { count += 1; }, 100);
assert.equal(timeouts.pending.length, 1, 'There should be 1 timeout pending, now');
assert.equal(count, 0, 'Count should not have incremented yet');

// Now let's fastforward.
timeouts.advanceTime(100);
assert.equal(timeouts.pending.length, 0, 'There should be 0 timeouts pending, now');
assert.equal(count, 1, 'Count should have incremented by 1');

// Set one, then cancel it.
const timeoutId = setTimeout(() => { count += 1; }, 100);
assert.equal(timeouts.pending.length, 1, 'There should be 1 timeout pending, now');
clearTimeout(timeoutId);
assert.equal(timeouts.pending.length, 0, 'There should be 0 timeouts pending, now');
timeouts.advanceTime(100);
assert.equal(count, 1, 'Count should not have incremented');
```



## API

This module consists of a single export, a function which creates a Timeouts Context:

```
module.exports :: () => TimeoutsContext;

interface TimeoutsContext {
    pending: Array<TimeoutEntry>;
    setTimeout: <TArgs extends any[]>(fn: (...args: TArgs) => any, ms: number, ...args: TArgs) => number;
    clearTimeout: (id: number) => void;
    advanceTime: (ms: number) => void;
}

interface TimeoutEntry<TArgs extends any[]> {
    id: number;
    ms: number;
    fn: (...args: TArgs) => any;
    args: TArgs;
}
```


### TimeoutsContext.pending

`Array<TimeoutEntry>`

Used primarily for checking how many timeouts are currently pending.


### TimeoutsContext.setTimeout(fn, ms, ...args)

`<TArgs extends any[]>(fn: (...args: TArgs) => any, ms: number, ...args: TArgs) => number`

Sets a timeout, adding an entry to `TimeoutsContext.pending`, and returning the id for that entry.


### TimeoutsContext.clearTimeout(id)

`(id: number) => void`

Clears a timeout in the bound context, removing it from `TimeoutsContext.pending` without executing it.


### TimeoutsContext.advanceTime(ms)

`(ms: number) => void`

"Ticks" time forward, decrementing each pending entry by the given amount.  Any entry that is brought to 0 or lower has its entry removed then its function called from `TimeoutsContext.pending`.

NOTE: All entries that tick over are removed first, _then_ all of them are called.
